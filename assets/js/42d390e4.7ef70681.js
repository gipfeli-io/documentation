"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[9263],{383:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>s,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var o=n(7462),i=(n(7294),n(3905));n(1839);const a={id:"backend-deployment",sidebar_position:3,title:"Backend deployment"},s=void 0,l={unversionedId:"infrastructure/backend-deployment",id:"infrastructure/backend-deployment",title:"Backend deployment",description:"Our backend is built with nest.js and runs its own process to handle incoming API requests.",source:"@site/docs/infrastructure/backend-deployment.md",sourceDirName:"infrastructure",slug:"/infrastructure/backend-deployment",permalink:"/docs/infrastructure/backend-deployment",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{id:"backend-deployment",sidebar_position:3,title:"Backend deployment"},sidebar:"tutorialSidebar",previous:{title:"Frontend deployment",permalink:"/docs/infrastructure/frontend-deployment"},next:{title:"Documentation deployment",permalink:"/docs/infrastructure/documentation-deployment"}},r={},d=[{value:"Deployment steps",id:"deployment-steps",level:2},{value:"Todo",id:"todo",level:2}],p={toc:d};function u(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Our backend is built with ",(0,i.kt)("a",{parentName:"p",href:"https://nestjs.com/"},"nest.js")," and runs its own process to handle incoming API requests."),(0,i.kt)("h2",{id:"deployment-steps"},"Deployment steps"),(0,i.kt)("p",null,"Deployment always happens when a push is sent to main. This triggers\nthe ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/gipfeli-io/gipfeli-api/blob/stage/.github/workflows/deployment.yml"},"GitHub Action")," that performs\nthe following steps:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Establish connection to our Google Cloud account using the official ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/google-github-actions/auth"},"google-github-actions/auth")," step."),(0,i.kt)("li",{parentName:"ol"},"After step 1, we can now use ",(0,i.kt)("inlineCode",{parentName:"li"},"gcloud")," tools. First, we configure the container registry."),(0,i.kt)("li",{parentName:"ol"},"At this point, we build the container image, assigning it a unique name (",(0,i.kt)("inlineCode",{parentName:"li"},"gcr.io/{project_id}/{app_name}:{commit_sha}"),")"),(0,i.kt)("li",{parentName:"ol"},"We push our previously built image to our registry"),(0,i.kt)("li",{parentName:"ol"},"Finally, we deploy our image to our CloudRun service. This automatically deploys our new image, starts its pod and gracefully replaces the old pod.")),(0,i.kt)("h2",{id:"todo"},"Todo"),(0,i.kt)("ul",{className:"contains-task-list"},(0,i.kt)("li",{parentName:"ul",className:"task-list-item"},(0,i.kt)("input",{parentName:"li",type:"checkbox",checked:!1,disabled:!0})," ","Change link to ",(0,i.kt)("inlineCode",{parentName:"li"},"main")," branch action when deployed to production")))}u.isMDXComponent=!0}}]);